WEBVTT

00:00:00.000 --> 00:00:03.836
Cloning Zwift on iOS Part 4: Workout View

00:00:05.336 --> 00:00:08.372
Published on September 29, 2019.

00:00:09.372 --> 00:00:16.884
I haven’t been working as much on my workout app since it’s been good enough for me to use as a replacement for Zwift with the most recent changes I wrote about.

00:00:17.884 --> 00:00:27.234
I got a new iPhone so I had to build and install the app on my phone again, and after firing up Xcode I decided to go ahead and add a few more things that I was meaning to add to the app.

00:00:27.734 --> 00:00:32.609
The app hasn’t had a good visualization of workouts so I ended up creating an interface for that.

00:00:33.609 --> 00:00:35.767
Taking cues from Zwift

00:00:37.267 --> 00:00:43.820
I didn’t want to reinvent the wheel here, so I decided to just copy how Zwift shows workouts, because it works pretty well.

00:00:44.320 --> 00:00:52.151
Not that I’m trying to write a whole 3d cycling MMORPG, but it helps to know where I am in a workout besides time elapsed and time remaining.

00:00:53.151 --> 00:01:00.423
The general idea is to code each segment with its color based on the difficulty zone, and its height based on the target wattage of that segment.

00:01:01.423 --> 00:01:08.056
I previously noted that the target wattage of a segment is based on the product of your own FTP and a multiplier.

00:01:08.556 --> 00:01:13.591
I did some reverse engineering and found that the color coded “zones” are based on this formula:

00:01:14.591 --> 00:01:20.904
I then just mapped the zones with the same colors, with zone 1 being gray, 2 being blue, etc.

00:01:21.404 --> 00:01:25.719
For the warmup and cooldown segments I just take the high power of those segments.

00:01:26.719 --> 00:01:28.078
Creating a View

00:01:29.578 --> 00:01:38.448
Creating custom views from scratch is really not my strong point, but I know enough about autolayout and UIKit to implement whatever views a designer throws at me.

00:01:38.948 --> 00:01:43.983
Unfortunately I don’t have designer to throw designs at me so I had to come up with something on my own.

00:01:44.983 --> 00:01:46.581
I was originally going to use a .

00:01:47.081 --> 00:01:51.716
xib file and set things up programmatically, but I realized that I really didn’t need a .

00:01:52.216 --> 00:01:54.853
xib and could do everything programmatically.

00:01:55.353 --> 00:02:02.705
I usually go with a hybrid approach to make the complicated parts easier, but in this case doing stuff in code is actually less complicated.

00:02:03.705 --> 00:02:09.618
I ended up going with a stack view based layout, where I inserted the views into a horizontal stack view.

00:02:10.118 --> 00:02:24.824
The view itself has a width anchor based on the percentage of time it takes (if it’s a 10 minute segment in a 30 minute workout then its width would be 33.3% of the container), and then a subview which has a height anchor based on the relative intensity of the segment.

00:02:25.324 --> 00:02:26.602
It works out pretty well.

00:02:27.602 --> 00:02:33.756
I threw the view into a UITableViewCell so I could visually get a clue what the workout I was selecting looks like:

00:02:34.756 --> 00:02:36.514
Finally Some Progress

00:02:38.014 --> 00:02:43.927
I was pretty happy with the stack view representation of the workouts and left it that way for a few months.

00:02:44.427 --> 00:02:49.861
Today I was refactoring some stuff and implemented something that was really bothering me for a while.

00:02:50.361 --> 00:02:57.953
In Zwift you get a really nice view of the upcoming segments, and where you are in your current segment.

00:02:58.453 --> 00:03:07.004
My app is not really good at this, and there was a bug where it not correctly display the upcoming segment sometimes because of the way it handled workout segment equality.

00:03:07.504 --> 00:03:14.297
Essentially it was looking for the index of a segment but if there were two exact same segments it would assume the first one was the correct one.

00:03:15.297 --> 00:03:19.852
Anyway, I fixed that bug by just tracking the actual index of the segment I was on.

00:03:20.852 --> 00:03:31.081
The other thing I wanted to add was a progress view, so I broke the Workout view into its own class and added a “progress” indicator, which is just a horizontal slider that slides over as you’re working out.

00:03:32.081 --> 00:03:38.714
This is what it looks like, if I was working out at 10x the regular speed (which would be easier I guess).

00:03:39.714 --> 00:03:41.232
That’s about it for now!

00:03:41.732 --> 00:03:49.164
I think this makes my app pretty usable and until I find another thing I need to add to it, I feel like this is a good replacement for Zwift.

00:03:49.664 --> 00:03:58.535
If you happen to need the exact same thing that I do and also happen to have the same exact exercise bike, feel free to clone the Github repo and use the app!
