WEBVTT

00:00:00.000 --> 00:00:03.436
Cloning Zwift on iOS Part 4: Workout View

00:00:04.936 --> 00:00:08.372
Published on September 29, 2019.

00:00:09.372 --> 00:00:17.124
I haven’t been working as much on my workout app since it’s been good enough for me to use as a replacement for Zwift with the most recent changes I wrote about.

00:00:18.124 --> 00:00:27.714
I got a new iPhone so I had to build and install the app on my phone again, and after firing up Xcode I decided to go ahead and add a few more things that I was meaning to add to the app.

00:00:28.214 --> 00:00:33.488
The app hasn’t had a good visualization of workouts so I ended up creating an interface for that.

00:00:34.488 --> 00:00:36.486
Taking cues from Zwift

00:00:37.986 --> 00:00:44.619
I didn’t want to reinvent the wheel here, so I decided to just copy how Zwift shows workouts, because it works pretty well.

00:00:45.119 --> 00:00:52.791
Not that I’m trying to write a whole 3d cycling MMORPG, but it helps to know where I am in a workout besides time elapsed and time remaining.

00:00:53.791 --> 00:01:01.462
The general idea is to code each segment with its color based on the difficulty zone, and its height based on the target wattage of that segment.

00:01:02.462 --> 00:01:08.935
I previously noted that the target wattage of a segment is based on the product of your own FTP and a multiplier.

00:01:09.435 --> 00:01:15.029
I did some reverse engineering and found that the color coded “zones” are based on this formula:

00:01:16.029 --> 00:01:18.826
0-60% = zone 1

00:01:19.826 --> 00:01:23.022
61-75% = zone 2

00:01:24.022 --> 00:01:27.459
76-89% = zone 3

00:01:28.459 --> 00:01:31.815
89-104% = zone 4

00:01:32.815 --> 00:01:36.091
105-118% = zone 5

00:01:37.091 --> 00:01:40.208
119%+ = zone 6

00:01:41.208 --> 00:01:47.201
I then just mapped the zones with the same colors, with zone 1 being gray, 2 being blue, etc.

00:01:47.701 --> 00:01:52.336
For the warmup and cooldown segments I just take the high power of those segments.

00:01:53.336 --> 00:01:54.854
Creating a View

00:01:56.354 --> 00:02:05.465
Creating custom views from scratch is really not my strong point, but I know enough about autolayout and UIKit to implement whatever views a designer throws at me.

00:02:05.965 --> 00:02:10.919
Unfortunately I don’t have designer to throw designs at me so I had to come up with something on my own.

00:02:11.919 --> 00:02:13.837
I was originally going to use a .

00:02:14.337 --> 00:02:19.531
xib file and set things up programmatically, but I realized that I really didn’t need a .

00:02:20.031 --> 00:02:22.748
xib and could do everything programmatically.

00:02:23.248 --> 00:02:30.121
I usually go with a hybrid approach to make the complicated parts easier, but in this case doing stuff in code is actually less complicated.

00:02:31.121 --> 00:02:37.274
I ended up going with a stack view based layout, where I inserted the views into a horizontal stack view.

00:02:37.774 --> 00:02:53.279
The view itself has a width anchor based on the percentage of time it takes (if it’s a 10 minute segment in a 30 minute workout then its width would be 33.3% of the container), and then a subview which has a height anchor based on the relative intensity of the segment.

00:02:53.779 --> 00:02:55.297
It works out pretty well.

00:02:56.297 --> 00:03:02.131
I threw the view into a UITableViewCell so I could visually get a clue what the workout I was selecting looks like:

00:03:03.131 --> 00:03:05.928
Finally Some Progress

00:03:07.428 --> 00:03:13.181
I was pretty happy with the stack view representation of the workouts and left it that way for a few months.

00:03:13.681 --> 00:03:18.556
Today I was refactoring some stuff and implemented something that was really bothering me for a while.

00:03:19.056 --> 00:03:24.490
In Zwift you get a really nice view of the upcoming segments, and where you are in your current segment.

00:03:24.990 --> 00:03:34.021
My app is not really good at this, and there was a bug where it not correctly display the upcoming segment sometimes because of the way it handled workout segment equality.

00:03:34.521 --> 00:03:41.713
Essentially it was looking for the index of a segment but if there were two exact same segments it would assume the first one was the correct one.

00:03:42.713 --> 00:03:47.667
Anyway, I fixed that bug by just tracking the actual index of the segment I was on.

00:03:48.667 --> 00:03:59.776
The other thing I wanted to add was a progress view, so I broke the Workout view into its own class and added a “progress” indicator, which is just a horizontal slider that slides over as you’re working out.

00:04:00.776 --> 00:04:06.370
This is what it looks like, if I was working out at 10x the regular speed (which would be easier I guess).

00:04:07.370 --> 00:04:09.208
That’s about it for now!

00:04:09.708 --> 00:04:16.660
I think this makes my app pretty usable and until I find another thing I need to add to it, I feel like this is a good replacement for Zwift.

00:04:17.160 --> 00:04:25.631
If you happen to need the exact same thing that I do and also happen to have the same exact exercise bike, feel free to clone the Github repo and use the app!
