WEBVTT

00:00:00.000 --> 00:00:03.680
Setting The Crontab Environment For Your Ruby on Rails Jobs

00:00:05.180 --> 00:00:07.740
Published on June 08, 2008.

00:00:08.740 --> 00:00:10.580
So today is my birthday.

00:00:11.080 --> 00:00:16.280
In honor of my birthday, I’ve been migrating some websites from my old server to a new one.

00:00:16.780 --> 00:00:21.740
Okay, it’s not really in honor of my birthday; I’m just doing it because I have some free time today.

00:00:22.740 --> 00:00:29.620
Anyway, one of the things that Anime Nano needs to do is run a crontab of a function from a Rails model using a crontab.

00:00:30.120 --> 00:00:32.200
If that made no sense to you, don’t worry.

00:00:32.700 --> 00:00:35.580
Just enjoy the pretty picture of the rails logo above.

00:00:36.080 --> 00:00:39.760
If that made sense to you, wow, you’re pretty hardcore.

00:00:40.760 --> 00:00:46.760
This is something that I remember spending time getting to work the last time I set up my server.

00:00:47.260 --> 00:00:52.540
But unfortunately I didn’t write about how I did it, so I had to spend an hour or so figuring it out again.

00:00:53.040 --> 00:00:56.800
Apparently, crontab runs in a different environment than the root user.

00:00:57.300 --> 00:01:02.100
If you try to run a script for Ruby using “ruby script/runner” you’ll just get nothing.

00:01:02.600 --> 00:01:05.080
No error message, just nothing.

00:01:05.580 --> 00:01:11.100
I did something on the previous server that set the crontab environment, but I have no idea what I did.

00:01:11.600 --> 00:01:14.080
I searched. I didn’t find the answer.

00:01:15.080 --> 00:01:25.800
So what I ended up doing (this is for future Hung when he has to eventually move his sites to an even newer server) is sticking some lines for my environment into the crontab itself.

00:01:26.300 --> 00:01:29.180
I just ran ‘env’ and got a bunch of stuff.

00:01:29.680 --> 00:01:38.160
Comparing the ‘env’ command run from the crontab itself (I just piped the output to a random text file) and running in my shell, I saw a few differences.

00:01:38.660 --> 00:01:40.420
Most notably these ones:

00:01:41.420 --> 00:01:51.980
GEM_HOME=/usr/local/rubygems/gems GEM_PATH=/usr/local/rubygems/gems RUBYLIB=/usr/local/rubygems/lib/ruby/site_ruby/1.8

00:01:52.980 --> 00:01:58.420
And voila, my crontabbed rails script/runner model script thing ran.

00:01:58.920 --> 00:02:01.960
Hopefully writing this post will save me some time in the future.

00:02:02.960 --> 00:02:04.800
Oh, and happy birthday to me.
